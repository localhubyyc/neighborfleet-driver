<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Track Your Order - YYC LocalFirst</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0f0f1a;
            --bg-card: #252542;
            --accent-green: #00d26a;
            --accent-green-dim: rgba(0, 210, 106, 0.15);
            --accent-orange: #ff6b35;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --text-dim: #6b6b80;
            --border-color: #353550;
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .container { max-width: 500px; margin: 0 auto; padding: 0.75rem; }
        .app-logo { text-align: center; padding: 0.5rem 0; }
        .logo-text { font-size: 1.3rem; font-weight: 800; }
        .logo-yyc {
            background: linear-gradient(135deg, #00d26a, #00a854);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .status-header { text-align: center; padding: 0.75rem 0; }
        .status-badge {
            display: inline-flex; align-items: center; gap: 0.5rem;
            background: var(--accent-green-dim); color: var(--accent-green);
            padding: 0.4rem 1rem; border-radius: 50px; font-weight: 600; font-size: 0.85rem;
        }
        .pulse-dot {
            width: 8px; height: 8px; background: currentColor; border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .status-header h1 { font-size: 1.35rem; font-weight: 800; margin: 0.5rem 0 0.2rem; }
        .status-header p { color: var(--text-secondary); font-size: 0.9rem; }
        
        .progress-container { padding: 0.5rem 0.5rem 1rem; }
        .progress-steps { display: flex; justify-content: space-between; position: relative; }
        .progress-line { position: absolute; top: 14px; left: 40px; right: 40px; height: 3px; background: var(--border-color); }
        .progress-fill { height: 100%; background: var(--accent-green); width: 75%; transition: width 0.5s; }
        .step { display: flex; flex-direction: column; align-items: center; gap: 0.4rem; z-index: 1; }
        .step-icon {
            width: 28px; height: 28px; border-radius: 50%; background: var(--border-color);
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem;
        }
        .step.completed .step-icon { background: var(--accent-green); }
        .step.active .step-icon { background: var(--accent-orange); box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.3); }
        .step-label { font-size: 0.65rem; color: var(--text-dim); font-weight: 500; }
        .step.completed .step-label, .step.active .step-label { color: var(--text-secondary); }

        .map-container {
            background: var(--bg-card); border-radius: 16px; overflow: hidden;
            margin-bottom: 0.75rem; height: 300px; position: relative;
        }
        #map { width: 100%; height: 100%; }
        .map-overlay {
            position: absolute; top: 10px; left: 10px; background: rgba(15, 15, 26, 0.95);
            border-radius: 12px; padding: 0.6rem 0.9rem; z-index: 100;
        }
        .eta-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; }
        .eta-value { font-size: 1.4rem; font-weight: 800; color: var(--accent-green); }
        .eta-value span { font-size: 0.8rem; font-weight: 600; }
        .speed-badge {
            position: absolute; top: 10px; right: 10px; background: var(--accent-orange);
            color: white; padding: 0.35rem 0.6rem; border-radius: 6px;
            font-size: 0.65rem; font-weight: 700; z-index: 100;
        }
        .route-info {
            position: absolute; bottom: 10px; left: 10px; right: 10px;
            background: rgba(15, 15, 26, 0.95); border-radius: 10px;
            padding: 0.5rem 0.75rem; z-index: 100; display: flex;
            justify-content: space-between; font-size: 0.75rem;
        }
        .route-info .label { color: var(--text-dim); }
        .route-info .value { color: var(--text-primary); font-weight: 600; }

        .driver-card {
            background: var(--bg-card); border-radius: 14px; padding: 0.9rem;
            margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.9rem;
        }
        .driver-avatar {
            width: 52px; height: 52px; border-radius: 50%; overflow: hidden; flex-shrink: 0;
        }
        .driver-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .driver-info { flex: 1; }
        .driver-name { font-size: 1rem; font-weight: 700; }
        .driver-vehicle { font-size: 0.8rem; color: var(--text-secondary); }
        .driver-rating { font-size: 0.75rem; margin-top: 0.15rem; }
        .driver-rating .stars { color: #fbbf24; letter-spacing: 1px; }
        .driver-rating .star-partial { color: #fbbf24; opacity: 0.9; position: relative; }
        .driver-rating .star-partial::after { content: '‚òÖ'; position: absolute; left: 0; color: #3a3a50; clip-path: inset(0 0 0 90%); }
        .call-btn {
            width: 42px; height: 42px; background: var(--accent-green); border: none;
            border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .call-btn svg { width: 20px; height: 20px; fill: white; }

        .order-card { background: var(--bg-card); border-radius: 14px; padding: 0.9rem; margin-bottom: 0.75rem; }
        .order-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 0.6rem; padding-bottom: 0.6rem; border-bottom: 1px solid var(--border-color);
        }
        .restaurant-name { font-weight: 700; font-size: 0.95rem; }
        .order-total { font-weight: 700; color: var(--accent-green); }
        .order-items { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5; }

        .addresses { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 0.75rem; }
        .address-card { background: var(--bg-card); border-radius: 14px; padding: 0.75rem; }
        .address-icon { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.4rem; font-size: 0.9rem; }
        .address-icon.pickup { background: rgba(255, 107, 53, 0.15); }
        .address-icon.delivery { background: var(--accent-green-dim); }
        .address-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.2rem; }
        .address-text { font-size: 0.8rem; font-weight: 500; line-height: 1.3; }

        .footer { text-align: center; padding: 1rem 0; color: var(--text-dim); font-size: 0.75rem; }
        .footer a { color: var(--accent-green); text-decoration: none; }
        .demo-badge {
            position: fixed; top: 8px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(135deg, #00d26a, #00a854); color: white;
            padding: 0.3rem 1rem; border-radius: 20px; font-size: 0.7rem;
            font-weight: 700; text-transform: uppercase; z-index: 1000;
        }
        .loading { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid var(--border-color); border-top-color: var(--accent-green); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="demo-badge">üöÄ Live Demo - 10x Speed</div>
    
    <div class="container">
        <div class="app-logo"><span class="logo-text"><span class="logo-yyc">YYC</span> LocalFirst</span></div>

        <div class="status-header">
            <div class="status-badge"><span class="pulse-dot"></span><span id="statusText">On the way</span></div>
            <h1 id="mainStatus">Your driver is en route</h1>
            <p id="subStatus">Raj is heading to your location</p>
        </div>

        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line"><div class="progress-fill" id="progressFill"></div></div>
                <div class="step completed"><div class="step-icon">‚úì</div><div class="step-label">Ordered</div></div>
                <div class="step completed"><div class="step-icon">‚úì</div><div class="step-label">Preparing</div></div>
                <div class="step completed"><div class="step-icon">‚úì</div><div class="step-label">Picked Up</div></div>
                <div class="step active" id="deliveryStep"><div class="step-icon">üöó</div><div class="step-label">Delivering</div></div>
            </div>
        </div>

        <div class="map-container">
            <div id="mapLoading" class="loading" style="position:absolute;top:0;left:0;right:0;bottom:0;background:var(--bg-card);z-index:50;">
                <div class="loading-spinner"></div>
                <p style="margin-top:1rem;color:var(--text-secondary);">Loading route...</p>
            </div>
            <div class="map-overlay">
                <div class="eta-label">Arriving in</div>
                <div class="eta-value" id="etaValue">-- <span>min</span></div>
            </div>
            <div class="speed-badge">10x SPEED</div>
            <div class="route-info">
                <div><span class="label">Distance:</span> <span class="value" id="distanceValue">-- km</span></div>
                <div><span class="label">Via:</span> <span class="value" id="routeVia">Loading...</span></div>
            </div>
            <div id="map"></div>
        </div>

        <div class="driver-card">
            <div class="driver-avatar">
                <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face" alt="Raj Singh">
            </div>
            <div class="driver-info">
                <div class="driver-name">Raj Singh</div>
                <div class="driver-vehicle">Red Toyota Camry ‚Ä¢ CYY 4R2</div>
                <div class="driver-rating"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ</span><span class="star-partial">‚òÖ</span> 4.9 (243 deliveries)</div>
            </div>
            <button class="call-btn" onclick="alert('Demo mode - calling disabled')">
                <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
            </button>
        </div>

        <div class="order-card">
            <div class="order-header">
                <div class="restaurant-name">üçï AB King Pizza</div>
                <div class="order-total">$42.99</div>
            </div>
            <div class="order-items">1√ó Super Loaded Pizza (Large) ‚Ä¢ 1√ó Meat Lovers (Medium)<br>1√ó Garlic Bread ‚Ä¢ 2√ó Coke</div>
        </div>

        <div class="addresses">
            <div class="address-card">
                <div class="address-icon pickup">üè¢</div>
                <div class="address-label">Picked up from</div>
                <div class="address-text">Suncor Energy Centre<br>150 6 Ave SW</div>
            </div>
            <div class="address-card">
                <div class="address-icon delivery">üè†</div>
                <div class="address-label">Delivering to</div>
                <div class="address-text">36 Sherwood Rise NW<br>Calgary</div>
            </div>
        </div>

        <div class="footer">Powered by <a href="#">YYC LocalFirst</a> ‚Ä¢ 15% commission, supporting local üíö</div>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4T_RiDo2RqzDZNnhoUwwsrEQqf1AjUMs&libraries=geometry&callback=initMap" async defer></script>
    <script>
        const START_POS = { lat: 51.0453, lng: -114.0713 };
        const END_POS = { lat: 51.1078, lng: -114.1347 };
        
        // ORIGINAL WORKING RED CAR IMAGE - DO NOT CHANGE
        const carImageBase64 = 'data:image/png;base64,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';

        let map, carMarker, directionsService, directionsRenderer;
        let routePath = [], currentIndex = 0, lastBearing = 0;
        let totalDistance = 0, totalDuration = 0, isZoomedIn = false;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: { lat: 51.0750, lng: -114.1000 },
                disableDefaultUI: true,
                styles: [
                    { elementType: "geometry", stylers: [{ color: "#1a1a2e" }] },
                    { elementType: "labels.text.stroke", stylers: [{ color: "#1a1a2e" }] },
                    { elementType: "labels.text.fill", stylers: [{ color: "#6b6b80" }] },
                    { featureType: "road", elementType: "geometry", stylers: [{ color: "#353550" }] },
                    { featureType: "road.highway", elementType: "geometry", stylers: [{ color: "#454560" }] },
                    { featureType: "water", elementType: "geometry", stylers: [{ color: "#0e0e1a" }] },
                    { featureType: "poi", stylers: [{ visibility: "off" }] },
                    { featureType: "transit", stylers: [{ visibility: "off" }] }
                ]
            });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map, suppressMarkers: true,
                polylineOptions: { strokeColor: '#00d26a', strokeOpacity: 0.7, strokeWeight: 5 }
            });
            calculateRoute();
        }

        function calculateRoute() {
            directionsService.route({
                origin: START_POS, destination: END_POS, travelMode: google.maps.TravelMode.DRIVING
            }, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                    const leg = result.routes[0].legs[0];
                    totalDistance = leg.distance.value / 1000;
                    totalDuration = leg.duration.value / 60;
                    document.getElementById('distanceValue').textContent = totalDistance.toFixed(1) + ' km';
                    document.getElementById('etaValue').innerHTML = Math.round(totalDuration) + ' <span>min</span>';
                    document.getElementById('routeVia').textContent = 'City Streets';
                    
                    routePath = [];
                    result.routes[0].overview_path.forEach(p => routePath.push({ lat: p.lat(), lng: p.lng() }));
                    routePath = interpolate(routePath, 250);
                    
                    addMarkers();
                    createCar();
                    document.getElementById('mapLoading').style.display = 'none';
                    setTimeout(startAnimation, 1500);
                }
            });
        }

        function interpolate(path, target) {
            const result = [];
            const perSeg = Math.ceil(target / path.length);
            for (let i = 0; i < path.length - 1; i++) {
                for (let j = 0; j < perSeg; j++) {
                    const t = j / perSeg;
                    result.push({ lat: path[i].lat + (path[i+1].lat - path[i].lat) * t, lng: path[i].lng + (path[i+1].lng - path[i].lng) * t });
                }
            }
            result.push(path[path.length - 1]);
            return result;
        }

        function addMarkers() {
            new google.maps.Marker({ position: START_POS, map: map, icon: { url: 'data:image/svg+xml,' + encodeURIComponent('<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="16" fill="#ff6b35" stroke="#fff" stroke-width="2"/><text x="20" y="26" text-anchor="middle" font-size="14">üè¢</text></svg>'), scaledSize: new google.maps.Size(40, 40), anchor: new google.maps.Point(20, 20) }});
            new google.maps.Marker({ position: END_POS, map: map, icon: { url: 'data:image/svg+xml,' + encodeURIComponent('<svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="16" fill="#00d26a" stroke="#fff" stroke-width="2"/><text x="20" y="26" text-anchor="middle" font-size="14">üè†</text></svg>'), scaledSize: new google.maps.Size(40, 40), anchor: new google.maps.Point(20, 20) }});
        }

        function createCar() {
            carMarker = new google.maps.Marker({ position: routePath[0], map: map, icon: getCarIcon(0), zIndex: 1000 });
        }

        function getCarIcon(bearing) {
            const rot = bearing - 90;
            return {
                url: 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80"><g transform="rotate(' + rot + ', 40, 40)"><image href="' + carImageBase64 + '" x="0" y="0" width="80" height="80"/></g></svg>'),
                scaledSize: new google.maps.Size(45, 45),
                anchor: new google.maps.Point(22, 22)
            };
        }

        function getBearing(from, to) {
            const dLng = (to.lng - from.lng) * Math.PI / 180;
            const lat1 = from.lat * Math.PI / 180, lat2 = to.lat * Math.PI / 180;
            const y = Math.sin(dLng) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLng);
            return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
        }

        function getDistanceToEnd(pos) {
            return google.maps.geometry.spherical.computeDistanceBetween(
                new google.maps.LatLng(pos.lat, pos.lng), new google.maps.LatLng(END_POS.lat, END_POS.lng)
            ) / 1000;
        }

        const MOVE_MS = 60;
        let moveStart, fromPos, toPos;

        function startAnimation() { currentIndex = 0; animate(); }

        function animate() {
            if (currentIndex >= routePath.length - 1) { showDelivered(); return; }
            fromPos = routePath[currentIndex];
            toPos = routePath[currentIndex + 1];
            moveStart = performance.now();

            const bearing = getBearing(fromPos, toPos);
            if (Math.abs(bearing - lastBearing) > 8) { lastBearing = bearing; carMarker.setIcon(getCarIcon(bearing)); }

            const progress = currentIndex / routePath.length;
            const remainingMin = Math.max(1, Math.round(totalDuration * (1 - progress)));
            const remainingKm = getDistanceToEnd(fromPos);
            document.getElementById('etaValue').innerHTML = remainingMin + ' <span>min</span>';
            document.getElementById('distanceValue').textContent = remainingKm.toFixed(1) + ' km';

            // ZOOM IN for last 3km
            if (remainingKm <= 3 && !isZoomedIn) { isZoomedIn = true; map.setZoom(15); document.getElementById('subStatus').textContent = 'Almost there!'; }
            if (remainingKm <= 1) { map.setZoom(16); }
            if (remainingKm <= 0.3) { map.setZoom(17); }

            requestAnimationFrame(step);
        }

        function step(ts) {
            const elapsed = ts - moveStart;
            const p = Math.min(elapsed / MOVE_MS, 1);
            const ease = p < 0.5 ? 2*p*p : 1 - Math.pow(-2*p + 2, 2) / 2;
            const lat = fromPos.lat + (toPos.lat - fromPos.lat) * ease;
            const lng = fromPos.lng + (toPos.lng - fromPos.lng) * ease;
            carMarker.setPosition({ lat, lng });
            if (currentIndex % (isZoomedIn ? 3 : 8) === 0) map.panTo({ lat, lng });
            if (p < 1) requestAnimationFrame(step);
            else { currentIndex++; animate(); }
        }

        function showDelivered() {
            document.getElementById('statusText').textContent = 'Delivered!';
            document.getElementById('mainStatus').textContent = 'Order Delivered! üéâ';
            document.getElementById('subStatus').textContent = 'Enjoy your meal!';
            document.getElementById('etaValue').innerHTML = '0 <span>min</span>';
            document.getElementById('distanceValue').textContent = '0 km';
            document.getElementById('progressFill').style.width = '100%';
            const step = document.getElementById('deliveryStep');
            step.classList.remove('active'); step.classList.add('completed');
            step.querySelector('.step-icon').textContent = '‚úì';
            map.setZoom(17); map.panTo(END_POS);
            setTimeout(() => location.reload(), 5000);
        }
    </script>
</body>
</html>
